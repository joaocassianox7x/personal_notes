

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PPPM vs. Ewald (Long-Range Coulomb) &mdash; Personal Notes</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Personal Notes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aboutme.html">About Me</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction of Material</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics and Computational Physics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pppm_ewald.html">PPPM vs Ewald (Long-Range Coulomb)</a></li>
<li class="toctree-l1"><a class="reference internal" href="double_pendulum.html">Double Pendulum via Lagrangian Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="computational_derivatives.html">Computational Derivatives</a></li>
<li class="toctree-l1"><a class="reference internal" href="force_fields.html">Force Fields : Water</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Math</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../math/functions.html">Functions and Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/limits.html">Limits</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DS, ML, and AI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ds_ai/python.html">Python for Data Science</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ds_ai/linear_regression.html">Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ds_ai/bias_variance.html">Bias - Variance Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ds_ai/backpropagation.html">Backpropagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ds_ai/pca.html">Principal Component Analysis (PCA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ds_ai/pca.html#references-and-further-reading">References and Further Reading</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Personal Notes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">PPPM vs. Ewald (Long-Range Coulomb)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/physics/pppm_ewald_old.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pppm-vs-ewald-long-range-coulomb">
<h1>PPPM vs. Ewald (Long-Range Coulomb)<a class="headerlink" href="#pppm-vs-ewald-long-range-coulomb" title="Link to this heading"></a></h1>
<p>Goal
Efficiently compute long-range electrostatics in periodic systems while keeping forces and energies accurate.</p>
</section>
<section id="classical-ewald-summation">
<h1>Classical Ewald Summation<a class="headerlink" href="#classical-ewald-summation" title="Link to this heading"></a></h1>
<p>The Ewald method decomposes the Coulomb potential into short-range (real-space) and long-range (reciprocal-space) components:</p>
<section id="potential-decomposition">
<h2>Potential Decomposition<a class="headerlink" href="#potential-decomposition" title="Link to this heading"></a></h2>
<p>The total electrostatic potential is split as:</p>
<div class="math notranslate nohighlight">
\[U_{\text{total}} = U_{\text{real}} + U_{\text{recip}} + U_{\text{self}}\]</div>
<p><strong>Step 1: Introduce the error function decomposition</strong></p>
<div class="math notranslate nohighlight">
\[\frac{1}{r} = \frac{\operatorname{erfc}(\alpha r)}{r} + \frac{\operatorname{erf}(\alpha r)}{r}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is the Ewald parameter (controls the split between real and reciprocal space).</p>
<p><strong>Step 2: Real-space contribution</strong></p>
<p>The short-range part uses the complementary error function:</p>
<div class="math notranslate nohighlight">
\[U_{\text{real}} = \frac{1}{2} \sum_{n \neq 0} \sum_{i,j} \frac{q_i q_j \operatorname{erfc}(\alpha r_{ij}^n)}{r_{ij}^n}\]</div>
<a class="reference internal image-reference" href="../_images/ewald_parameter_effect.png"><img alt="Real-space and force contributions for different Ewald parameters" class="align-center" src="../_images/ewald_parameter_effect.png" style="width: 100%;" />
</a>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r_{ij}^n = |\mathbf{r}_i - \mathbf{r}_j - \mathbf{L}n|\)</span> is the distance including periodic images (image index <span class="math notranslate nohighlight">\(n\)</span>).</p></li>
<li><p>The sum is truncated at a cutoff radius <span class="math notranslate nohighlight">\(r_c\)</span>.</p></li>
<li><p>This converges rapidly for larger <span class="math notranslate nohighlight">\(\alpha\)</span>.</p></li>
</ul>
<p><strong>Step 3: Reciprocal-space contribution</strong></p>
<p>The long-range part is evaluated in Fourier space:</p>
<div class="math notranslate nohighlight">
\[U_{\text{recip}} = \frac{1}{2V} \sum_{\mathbf{k} \neq 0} \frac{4\pi}{k^2} e^{-k^2/(4\alpha^2)} \left| \sum_{i} q_i e^{i\mathbf{k} \cdot \mathbf{r}_i} \right|^2\]</div>
<a class="reference internal image-reference" href="../_images/reciprocal_space_dampening.png"><img alt="Reciprocal-space factor dampening for different Ewald parameters" class="align-center" src="../_images/reciprocal_space_dampening.png" style="width: 100%;" />
</a>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{k}\)</span> are reciprocal-space vectors: <span class="math notranslate nohighlight">\(\mathbf{k} = 2\pi (n_x/L_x, n_y/L_y, n_z/L_z)\)</span> with <span class="math notranslate nohighlight">\(n_x, n_y, n_z\)</span> integers.</p></li>
<li><p><span class="math notranslate nohighlight">\(V\)</span> is the system volume.</p></li>
<li><p>The sum converges exponentially due to the <span class="math notranslate nohighlight">\(e^{-k^2/(4\alpha^2)}\)</span> factor.</p></li>
</ul>
<p><strong>Step 4: Self-interaction correction</strong></p>
<div class="math notranslate nohighlight">
\[U_{\text{self}} = -\frac{\alpha}{\sqrt{\pi}} \sum_i q_i^2\]</div>
<p>This removes the spurious self-energy from the continuous charge distribution approximation.</p>
<p><strong>Step 5: Total energy</strong></p>
<div class="math notranslate nohighlight">
\[U_{\text{Ewald}} = U_{\text{real}} + U_{\text{recip}} + U_{\text{self}}\]</div>
</section>
<section id="computational-cost">
<h2>Computational Cost<a class="headerlink" href="#computational-cost" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Real-space: <span class="math notranslate nohighlight">\(\mathcal{O}(N \cdot N_{\text{pairs}})\)</span> with short cutoff → effectively <span class="math notranslate nohighlight">\(\mathcal{O}(N)\)</span>.</p></li>
<li><p>Reciprocal-space: <span class="math notranslate nohighlight">\(\mathcal{O}(N_{\mathbf{k}})\)</span> where <span class="math notranslate nohighlight">\(N_{\mathbf{k}} \approx N\)</span> for comparable accuracy.</p></li>
<li><p><strong>Total: approximately</strong> <span class="math notranslate nohighlight">\(\mathcal{O}(N^{3/2})\)</span> overall; expensive for large <span class="math notranslate nohighlight">\(N\)</span>.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/ewald_pppm_complexity.png"><img alt="Computational complexity comparison between Ewald and PPPM methods" class="align-center" src="../_images/ewald_pppm_complexity.png" style="width: 100%;" />
</a>
<p><em>Ewald becomes computationally expensive for systems with more than ~10,000 particles.</em></p>
</section>
<section id="forces">
<h2>Forces<a class="headerlink" href="#forces" title="Link to this heading"></a></h2>
<p>Forces are obtained from the negative gradient:</p>
<div class="math notranslate nohighlight">
\[\mathbf{F}_i = -\nabla_i U_{\text{Ewald}}\]</div>
<p>Real-space forces:</p>
<div class="math notranslate nohighlight">
\[\mathbf{F}_{i, \text{real}} = q_i \sum_{j,n} q_j \frac{\mathbf{r}_{ij}^n}{(r_{ij}^n)^3} \left[ \operatorname{erfc}(\alpha r_{ij}^n) + \frac{2\alpha}{\sqrt{\pi}} r_{ij}^n e^{-(\alpha r_{ij}^n)^2} \right]\]</div>
<p>Reciprocal-space forces are computed via FFT derivatives (see PPPM section).</p>
</section>
</section>
<section id="pppm-particleparticle-particlemesh">
<h1>PPPM (Particle–Particle Particle–Mesh)<a class="headerlink" href="#pppm-particleparticle-particlemesh" title="Link to this heading"></a></h1>
<p>PPPM also splits the potential into short- and long-range parts but uses a mesh and FFT for efficiency.</p>
<section id="decomposition-strategy">
<h2>Decomposition Strategy<a class="headerlink" href="#decomposition-strategy" title="Link to this heading"></a></h2>
<p>Like Ewald, we separate:</p>
<div class="math notranslate nohighlight">
\[U_{\text{total}} = U_{\text{real}} + U_{\text{mesh}}\]</div>
<p><strong>Step 1: Real-space (short-range)</strong></p>
<p>Same as Ewald:</p>
<div class="math notranslate nohighlight">
\[U_{\text{real}} = \frac{1}{2} \sum_{n \neq 0} \sum_{i,j} \frac{q_i q_j \operatorname{erfc}(\alpha r_{ij}^n)}{r_{ij}^n}\]</div>
<p>with cutoff <span class="math notranslate nohighlight">\(r_c\)</span>.</p>
</section>
<section id="mesh-based-long-range-calculation">
<h2>Mesh-based Long-Range Calculation<a class="headerlink" href="#mesh-based-long-range-calculation" title="Link to this heading"></a></h2>
<p><strong>Step 2: Assign charges to the mesh</strong></p>
<p>Charges are spread onto a regular 3D grid using an interpolation function <span class="math notranslate nohighlight">\(w(x)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\rho(\mathbf{r}) = \sum_i q_i w(\mathbf{r} - \mathbf{r}_i)\]</div>
<p>Common choice: polynomial (e.g., linear, quadratic, cubic) assignment functions.</p>
<p><strong>Step 3: Solve Poisson’s equation on the mesh</strong></p>
<p>In reciprocal space:</p>
<div class="math notranslate nohighlight">
\[\hat{\phi}(\mathbf{k}) = \frac{4\pi}{k^2} e^{-k^2/(4\alpha^2)} \hat{\rho}(\mathbf{k})\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{\rho}\)</span> is the FFT of the gridded charge density.</p></li>
<li><p>The factor <span class="math notranslate nohighlight">\(e^{-k^2/(4\alpha^2)}\)</span> damps high-frequency modes (smoothing).</p></li>
</ul>
<p>Compute inverse FFT to get the potential on the mesh:</p>
<div class="math notranslate nohighlight">
\[\phi(\mathbf{r}) = \mathcal{F}^{-1}\left[ \hat{\phi}(\mathbf{k}) \right]\]</div>
<p><strong>Step 4: Interpolate forces back to particles</strong></p>
<p>The electric field on the mesh:</p>
<div class="math notranslate nohighlight">
\[\mathbf{E}(\mathbf{r}) = -\nabla \phi(\mathbf{r})\]</div>
<p>Interpolate to particle positions using the same function <span class="math notranslate nohighlight">\(w\)</span>:</p>
<div class="math notranslate nohighlight">
\[\mathbf{E}_i = \sum_{\mathbf{r}_{\text{grid}}} \mathbf{E}(\mathbf{r}_{\text{grid}}) w(\mathbf{r}_{\text{grid}} - \mathbf{r}_i)\]</div>
<p><strong>Step 5: Mesh-based force</strong></p>
<div class="math notranslate nohighlight">
\[\mathbf{F}_{i, \text{mesh}} = q_i \mathbf{E}_i\]</div>
</section>
<section id="id1">
<h2>Computational Cost<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Charge assignment: <span class="math notranslate nohighlight">\(\mathcal{O}(N)\)</span>.</p></li>
<li><p>FFT: <span class="math notranslate nohighlight">\(\mathcal{O}(N_{\text{grid}} \log N_{\text{grid}})\)</span> where <span class="math notranslate nohighlight">\(N_{\text{grid}}\)</span> is the number of grid points.</p></li>
<li><p>Interpolation: <span class="math notranslate nohighlight">\(\mathcal{O}(N)\)</span>.</p></li>
<li><p>Real-space: <span class="math notranslate nohighlight">\(\mathcal{O}(N)\)</span> with short cutoff.</p></li>
<li><p><strong>Total: approximately</strong> <span class="math notranslate nohighlight">\(\mathcal{O}(N \log N)\)</span> — much faster than Ewald for large systems.</p></li>
</ul>
</section>
<section id="accuracy-control">
<h2>Accuracy Control<a class="headerlink" href="#accuracy-control" title="Link to this heading"></a></h2>
<p>Errors in PPPM arise from:</p>
<ol class="arabic simple">
<li><p><strong>Grid discretization error</strong> — reduced by increasing grid resolution.</p></li>
<li><p><strong>Assignment/interpolation error</strong> — reduced by using higher-order assignment functions.</p></li>
<li><p><strong>Real-space cutoff error</strong> — reduced by increasing <span class="math notranslate nohighlight">\(r_c\)</span> and/or <span class="math notranslate nohighlight">\(\alpha\)</span>.</p></li>
</ol>
<p>Fine-tuning these parameters allows direct control of accuracy versus speed.</p>
<a class="reference internal image-reference" href="../_images/pppm_grid_convergence.png"><img alt="PPPM convergence with grid resolution and accuracy-cost trade-offs" class="align-center" src="../_images/pppm_grid_convergence.png" style="width: 100%;" />
</a>
</section>
</section>
<section id="practical-comparison">
<h1>Practical Comparison<a class="headerlink" href="#practical-comparison" title="Link to this heading"></a></h1>
<a class="reference internal image-reference" href="../_images/method_selection_diagram.png"><img alt="Decision diagram for selecting between Ewald and PPPM methods" class="align-center" src="../_images/method_selection_diagram.png" style="width: 100%;" />
</a>
<section id="ewald-summation">
<h2>Ewald Summation<a class="headerlink" href="#ewald-summation" title="Link to this heading"></a></h2>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p>Exact (within machine precision) for a given <span class="math notranslate nohighlight">\(\alpha\)</span>.</p></li>
<li><p>Straightforward parameter tuning via <span class="math notranslate nohighlight">\(\alpha\)</span>, real/reciprocal cutoffs.</p></li>
<li><p>Well-established for small to moderate systems.</p></li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul class="simple">
<li><p>Computational scaling <span class="math notranslate nohighlight">\(\mathcal{O}(N^{3/2})\)</span> becomes prohibitive for <span class="math notranslate nohighlight">\(N &gt; 10^4\)</span> particles.</p></li>
<li><p>Requires careful selection of <span class="math notranslate nohighlight">\(\alpha\)</span> and both real and reciprocal cutoffs.</p></li>
</ul>
<p><strong>Best for:</strong></p>
<ul class="simple">
<li><p>Systems with modest particle count (<span class="math notranslate nohighlight">\(N \lesssim 10^4\)</span>).</p></li>
<li><p>Applications requiring high accuracy and exact Coulomb summation.</p></li>
</ul>
</section>
<section id="pppm-method">
<h2>PPPM Method<a class="headerlink" href="#pppm-method" title="Link to this heading"></a></h2>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p>Fast scaling <span class="math notranslate nohighlight">\(\mathcal{O}(N \log N)\)</span> suitable for large systems.</p></li>
<li><p>Errors controlled by independent, tunable parameters (grid size, assignment order, real-space cutoff).</p></li>
<li><p>Efficient FFT implementations on modern hardware.</p></li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul class="simple">
<li><p>Introduces discretization error (not exact).</p></li>
<li><p>Requires more careful parameter selection and validation.</p></li>
<li><p>Grid memory overhead for very large cutoffs.</p></li>
</ul>
<p><strong>Best for:</strong></p>
<ul class="simple">
<li><p>Large periodic simulations (<span class="math notranslate nohighlight">\(N &gt; 10^4\)</span> particles).</p></li>
<li><p>High-throughput molecular dynamics and particle simulations.</p></li>
<li><p>Systems where slight discretization errors are acceptable for speed gains.</p></li>
</ul>
</section>
</section>
<section id="summary-table">
<h1>Summary Table<a class="headerlink" href="#summary-table" title="Link to this heading"></a></h1>
<a class="reference internal image-reference" href="../_images/energy_decomposition.png"><img alt="Energy contribution from real-space component vs Ewald parameter" class="align-center" src="../_images/energy_decomposition.png" style="width: 100%;" />
</a>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Ewald vs. PPPM Comparison</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 26.3%" />
<col style="width: 36.8%" />
<col style="width: 36.8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Aspect</p></th>
<th class="head"><p>Ewald</p></th>
<th class="head"><p>PPPM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Computational Complexity</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathcal{O}(N^{3/2})\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathcal{O}(N \log N)\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Accuracy</strong></p></td>
<td><p>Machine precision</p></td>
<td><p>Tunable via grid/assignment</p></td>
</tr>
<tr class="row-even"><td><p><strong>Best System Size</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(N \lesssim 10^4\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(N \gg 10^4\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Primary Parameters</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(r_c^{\text{real}}\)</span>, <span class="math notranslate nohighlight">\(r_c^{\text{recip}}\)</span></p></td>
<td><p>Grid size, assignment order, <span class="math notranslate nohighlight">\(r_c\)</span>, <span class="math notranslate nohighlight">\(\alpha\)</span></p></td>
</tr>
<tr class="row-even"><td><p><strong>Memory</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathcal{O}(N)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\mathcal{O}(N_{\text{grid}})\)</span></p></td>
</tr>
</tbody>
</table>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright J. V. V. Cassiano.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>